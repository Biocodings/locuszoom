!function() {
    try {

        // Verify that the two third-party dependencies are met: d3 and Q
        var minimum_d3_version = "3.5.6";
        if (typeof d3 != "object"){
            throw("LocusZoom unable to load: d3 dependency not met. Library missing.");
        } else if (d3.version < minimum_d3_version){
            throw("LocusZoom unable to load: d3 dependency not met. Outdated version detected.\nRequired d3 version: " + minimum_d3_version + " or higher (found: " + d3.version + ").");
        }
        if (typeof Q != "function"){
            throw("LocusZoom unable to load: Q dependency not met. Library missing.");
        }
        
        var LocusZoom={version:"0.1"};LocusZoom._instances={},LocusZoom.addInstanceToDivById=function(e,o,t,a){var n=LocusZoom._instances[e]=new t(e,o,t,a);if(n.svg=d3.select("div#"+e).append("svg").attr("id",e+"_svg").attr("class","lz-locuszoom"),n.setDimensions(),n.initialize(),"undefined"!=typeof n.svg.node().parentNode.dataset&&"undefined"!=typeof n.svg.node().parentNode.dataset.region){var s=n.svg.node().parentNode.dataset.region.split(/\D/);n.mapTo(+s[0],+s[1],+s[2])}return n},LocusZoom.populate=function(e,o,t,a){"undefined"==typeof e&&(e=".lz-instance"),"undefined"==typeof t&&(t=LocusZoom.DefaultInstance),"undefined"==typeof a&&(a={});var n;return d3.select(e).each(function(){n=LocusZoom.addInstanceToDivById(this.id,o,t,a)}),n},LocusZoom.populateAll=function(e,o,t,a){var n=[];return d3.selectAll(e).each(function(e,s){n[s]=LocusZoom.populate(this,o,t,a)}),n},LocusZoom.formatMegabase=function(e){var o=Math.max(6-Math.floor((Math.log(e)/Math.LN10).toFixed(9)),2);return""+(e/Math.pow(10,6)).toFixed(o)},LocusZoom.parsePosition=function(e){var o=e.toUpperCase();o=o.replace(",","");var t=/([KMG])[B]*$/,a=t.exec(o),n=1;return a&&(n="M"==a[1]?1e6:"G"==a[1]?1e9:1e3,o=o.replace(t,"")),o=Number(o)*n},LocusZoom.parsePositionQuery=function(e){var o=/^(\w+):([\d,.]+[kmgbKMGB]*)([-+])([\d,.]+[kmgbKMGB]*)$/,t=/^(\w+):([\d,.]+[kmgbKMGB]*)$/,a=o.exec(e);if(a){if("+"==a[3]){var n=LocusZoom.parsePosition(a[2]),s=LocusZoom.parsePosition(a[4]);return{chr:a[1],start:n-s,end:n+s}}return{chr:a[1],start:LocusZoom.parsePosition(a[2]),end:LocusZoom.parsePosition(a[4])}}return a=t.exec(e),a?{chr:a[1],position:LocusZoom.parsePosition(a[2])}:null},LocusZoom.prettyTicks=function(e,o,t){("undefined"==typeof o||isNaN(parseInt(o)))&&(o=5),o=parseInt(o),"undefined"==typeof t&&(t=!1);var a=o/3,n=.75,s=1.5,r=.5+1.5*s,i=Math.abs(e[0]-e[1]),u=i/o;Math.log(i)/Math.LN10<-2&&(u=Math.max(Math.abs(i))*n/a);var c=Math.pow(10,Math.floor(Math.log(u)/Math.LN10)),d=0;1>c&&(d=Math.abs(Math.round(Math.log(c)/Math.LN10)));var p=c;s*(u-p)>2*c-u&&(p=2*c,r*(u-p)>5*c-u&&(p=5*c,s*(u-p)>10*c-u&&(p=10*c)));var f=[];if(e[0]<=p)var l=0;else{var l=Math.floor(e[0]/p)*p;l=parseFloat(l.toFixed(d))}for(;l<e[1];)f.push(l),l+=p,d>0&&(l=parseFloat(l.toFixed(d)));return f.push(l),t&&(f[0]<e[0]&&(f=f.slice(1)),f[f.length-1]>e[1]&&f.pop()),f},LocusZoom.createCORSPromise=function(e,o,t,a){var n=Q.defer(),s=new XMLHttpRequest;return"withCredentials"in s?s.open(e,o,!0):"undefined"!=typeof XDomainRequest?(s=new XDomainRequest,s.open(e,o)):s=null,s&&(s.onreadystatechange=function(){4===s.readyState&&(200===s.status||0===s.status?n.resolve(JSON.parse(s.responseText)):n.reject("HTTP"+s.status+" for "+o))},a&&setTimeout(n.reject,a),t="undefined"!=typeof t?t:"",s.send(t)),n.promise};
"use strict";LocusZoom.DataSources=function(){this.sources={}},LocusZoom.DataSources.prototype.addSource=function(o,t){function e(o){if(!LocusZoom.KnownDataSources)return null;for(var t=0;t<LocusZoom.KnownDataSources.length;t++){if(!LocusZoom.KnownDataSources[t].SOURCE_NAME)throw"KnownDataSource at position "+t+" does not have a 'SOURCE_NAME' static property";if(LocusZoom.KnownDataSources[t].SOURCE_NAME==o)return LocusZoom.KnownDataSources[t]}return null}if(Array.isArray(t)){var r=e(t[0]);if(!r)throw"Unable to resolve "+t[0]+" data source";this.sources[o]=new r(t[1])}else this.sources[o]=t;return this},LocusZoom.DataSources.prototype.getSource=function(o){return this.sources[o]},LocusZoom.DataSources.prototype.setSources=function(o){"string"==typeof o&&(o=JSON.parse(o));var t=this;return Object.keys(o).forEach(function(e){t.addSource(e,o[e])}),t},LocusZoom.DataSources.prototype.keys=function(){return Object.keys(this.sources)},LocusZoom.DataSources.prototype.toJSON=function(){return this.sources},LocusZoom.Data=LocusZoom.Data||{},LocusZoom.Data.Requester=function(o){function t(o){var t={};return o.forEach(function(o){var e=o.split(/\:(.*)/);1==e.length?("undefined"==typeof t.base&&(t.base={names:[],fields:[]}),t.base.names.push(o),t.base.fields.push(o)):("undefined"==typeof t[e[0]]&&(t[e[0]]={names:[],fields:[]}),t[e[0]].names.push(o),t[e[0]].fields.push(e[1]))}),t}this.getData=function(e,r){for(var s=t(r),n=Object.keys(s).map(function(t){if(!o.getSource(t))throw"Datasource for namespace "+t+" not found";return o.getSource(t).getData(e,s[t].fields,s[t].names)}),a=Q.when({header:{},body:{}}),u=0;u<n.length;u++)a=a.then(n[u]);return a}},LocusZoom.Data.Source=function(){},LocusZoom.Data.Source.prototype.parseInit=function(o){if("string"==typeof o?(this.url=o,this.params={}):(this.url=o.url,this.params=o.params||{}),!this.url)throw"Source not initialized with required URL"},LocusZoom.Data.Source.prototype.getRequest=function(o,t,e){return LocusZoom.createCORSPromise("GET",this.getURL(o,t,e))},LocusZoom.Data.Source.prototype.getData=function(o,t,e){return function(r){return this.getRequest(o,r,t).then(function(o){return this.parseResponse(o,r,t,e)}.bind(this))}.bind(this)},LocusZoom.Data.Source.prototype.toJSON=function(){return[Object.getPrototypeOf(this).constructor.SOURCE_NAME,{url:this.url,params:this.params}]},LocusZoom.Data.AssociationSource=function(o){this.parseInit(o),this.getData=function(o,t,e){return["id","position"].forEach(function(o){-1==t.indexOf(o)&&(t.unshift(o),e.unshift(o))}),function(r){return this.getRequest(o,r).then(function(o){return this.parseResponse(o,r,t,e)}.bind(this))}.bind(this)}},LocusZoom.Data.AssociationSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.AssociationSource.prototype.constructor=LocusZoom.Data.AssociationSource,LocusZoom.Data.AssociationSource.prototype.getURL=function(o,t,e){var r=o.analysis||t.header.analysis||this.params.analysis||3;return this.url+"results/?filter=analysis in "+r+" and chromosome in  '"+o.chr+"' and position ge "+o.start+" and position le "+o.end},LocusZoom.Data.AssociationSource.prototype.parseResponse=function(o,t,e,r){var s=o.data,n=[];e.forEach(function(o){if(!(o in s))throw"field "+o+" not found in response"});for(var a=0;a<s.position.length;a++){for(var u={},c=0;c<e.length;c++)u[r[c]]=s[e[c]][a];n.push(u)}var i={header:t.header||{},body:n};return i},LocusZoom.Data.AssociationSource.SOURCE_NAME="AssociationLZ",LocusZoom.Data.LDSource=function(o){this.parseInit(o),this.getData=function(o,t,e){if(t.length>1)throw"LD currently only supports one field";return function(r){return this.getRequest(o,r,t).then(function(o){return this.parseResponse(o,r,t,e)}.bind(this))}.bind(this)}},LocusZoom.Data.LDSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.LDSource.prototype.constructor=LocusZoom.Data.LDSource,LocusZoom.Data.LDSource.prototype.getURL=function(o,t,e){var r=function(o,t){t=t||"pvalue";for(var e=o[0][t],r=0,s=1;s<o.length;s++)o[s][t]<e&&(e=o[s][t],r=s);return r},s=o.ldrefsource||t.header.ldrefsource||1,n=e[0];if("state"==n&&(n=o.ldrefvar||t.header.ldrefvar||"best"),"best"==n){if(!t.body)throw"No association data found to find best pvalue";n=t.body[r(t.body)].id}return t.header||(t.header={}),t.header.ldrefvar=n,this.url+"results/?filter=reference eq "+s+" and chromosome2 eq '"+o.chr+"' and position2 ge "+o.start+" and position2 le "+o.end+" and variant1 eq '"+n+"'&fields=chr,pos,rsquare"},LocusZoom.Data.LDSource.prototype.parseResponse=function(o,t,e,r){var s=function(o,t,e,r){for(var s=0,n=0;s<o.length&&n<t.position2.length;)o[s].position==t.position2[n]?(o[s][e]=t[r][n],s++,n++):o[s].position<t.position2[n]?s++:n++};return s(t.body,o.data,r[0],"rsquare"),t},LocusZoom.Data.LDSource.SOURCE_NAME="LDLZ",LocusZoom.Data.GeneSource=function(o){this.parseInit(o),this.getData=function(o,t,e){return function(r){return this.getRequest(o,r,t).then(function(o){return this.parseResponse(o,r,t,e)}.bind(this))}.bind(this)}},LocusZoom.Data.GeneSource.prototype=Object.create(LocusZoom.Data.Source.prototype),LocusZoom.Data.GeneSource.prototype.constructor=LocusZoom.Data.GeneSource,LocusZoom.Data.GeneSource.prototype.getURL=function(o,t,e){return this.url+"?filter=source in 1 and chrom eq '"+o.chr+"' and start le "+o.end+" and end ge "+o.start},LocusZoom.Data.GeneSource.prototype.parseResponse=function(o,t,e,r){return{header:t.header,body:o.data}},LocusZoom.Data.GeneSource.SOURCE_NAME="GeneLZ",LocusZoom.createResolvedPromise=function(){var o=Q.defer();return o.resolve(Array.prototype.slice.call(arguments)),o.promise},LocusZoom.KnownDataSources=[LocusZoom.Data.AssociationSource,LocusZoom.Data.LDSource,LocusZoom.Data.GeneSource];
"use strict";LocusZoom.Instance=function(t,s,i,e){return this.id=t,this.parent=LocusZoom,this.svg=null,this._panels={},this.state=e||{chr:0,start:0,end:0},this.view={width:0,height:0},this.lzd=new LocusZoom.Data.Requester(s),this},LocusZoom.Instance.prototype.setDimensions=function(t,s){return isNaN(t)||(this.view.width=Math.max(Math.round(+t),0)),isNaN(s)||(this.view.height=Math.max(Math.round(+s),0)),null!=this.svg&&this.svg.attr("width",this.view.width).attr("height",this.view.height),this},LocusZoom.Instance.prototype.addPanel=function(t){if("function"!=typeof t)return!1;var s=new t;return s.parent=this,this._panels[s.id]=s,this._panels[s.id]},LocusZoom.Instance.prototype.initialize=function(){for(var t in this._panels)this._panels[t].initialize();return this},LocusZoom.Instance.prototype.mapTo=function(t,s,i){this.state.chr=+t,this.state.start=+s,this.state.end=+i;for(var e in this._panels)this._panels[e].reMap();return this},LocusZoom.DefaultInstance=function(){return LocusZoom.Instance.apply(this,arguments),this.setDimensions(700,700),this.addPanel(LocusZoom.PositionsPanel).setOrigin(0,0).setDimensions(700,350).setMargin(20,20,35,50),this._panels.positions.addDataLayer(LocusZoom.PositionsDataLayer).attachToYAxis(1),this.addPanel(LocusZoom.GenesPanel).setOrigin(0,350).setDimensions(700,350).setMargin(20,20,20,50),this._panels.genes.addDataLayer(LocusZoom.GenesDataLayer),this},LocusZoom.DefaultInstance.prototype=new LocusZoom.Instance;
"use strict";LocusZoom.Panel=function(){return this.id=null,this.parent=null,this.svg=null,this.view={width:0,height:0,origin:{x:0,y:0},margin:{top:0,right:0,bottom:0,left:0},cliparea:{width:0,height:0,origin:{x:0,y:0}}},this.state={},this._data_layers={},this.data_layer_ids_by_z_index=[],this.data_promises=[],this.axes={x:{render:!1,ticks:[],label:null},y1:{render:!1,data_layer_id:null,ticks:[],label:null},y2:{render:!1,data_layer_id:null,ticks:[],label:null}},this.xExtent=null,this.y1Extent=null,this.y2Extent=null,this.renderData=function(){},this.getBaseId=function(){return this.parent.id+"."+this.id},this},LocusZoom.Panel.prototype.setDimensions=function(t,i){return"undefined"!=typeof t&&(this.view.width=+t),"undefined"!=typeof i&&(this.view.height=+i),this.view.cliparea.width=this.view.width-(this.view.margin.left+this.view.margin.right),this.view.cliparea.height=this.view.height-(this.view.margin.top+this.view.margin.bottom),this},LocusZoom.Panel.prototype.setOrigin=function(t,i){return"undefined"!=typeof t&&(this.view.origin.x=+t),"undefined"!=typeof i&&(this.view.origin.y=+i),this},LocusZoom.Panel.prototype.setMargin=function(t,i,e,s){return"undefined"!=typeof t&&(this.view.margin.top=+t),"undefined"!=typeof i&&(this.view.margin.right=+i),"undefined"!=typeof e&&(this.view.margin.bottom=+e),"undefined"!=typeof s&&(this.view.margin.left=+s),this.view.cliparea.width=this.view.width-(this.view.margin.left+this.view.margin.right),this.view.cliparea.height=this.view.height-(this.view.margin.top+this.view.margin.bottom),this.view.cliparea.origin.x=this.view.margin.left,this.view.cliparea.origin.y=this.view.margin.top,this},LocusZoom.Panel.prototype.initialize=function(){var t=this.parent.svg.append("g").attr("id",this.getBaseId()+".panel_container").attr("transform","translate("+this.view.origin.x+","+this.view.origin.y+")");t.append("clipPath").attr("id",this.getBaseId()+".clip").append("rect").attr("width",this.view.width).attr("height",this.view.height),this.svg=t.append("g").attr("id",this.getBaseId()+".panel").attr("clip-path","url(#"+this.getBaseId()+".clip)");for(var i in this._data_layers)this._data_layers[i].initialize();return this.axes.x.render&&(this.state.x_scale=d3.scale.linear().domain([0,1]).range([0,this.view.cliparea.width]),this.state.x_axis=d3.svg.axis().scale(this.state.x_scale).orient("bottom"),this.svg.append("g").attr("class","lz-x lz-axis").attr("transform","translate("+this.view.margin.left+","+(this.view.height-this.view.margin.bottom)+")").call(this.state.x_axis)),this.axes.y1.render&&(this.state.y1_scale=d3.scale.linear().domain([0,1]).range([this.view.cliparea.height,0]).nice(),this.state.y1_axis=d3.svg.axis().scale(this.state.y1_scale).orient("left"),this.svg.append("g").attr("class","lz-y lz-y1 lz-axis").attr("transform","translate("+this.view.margin.left+","+this.view.margin.top+")").call(this.state.y1_axis)),this.axes.y2.render&&(this.state.y2_scale=d3.scale.linear().domain([0,1]).range([this.view.cliparea.height,0]).nice(),this.state.y2_axis=d3.svg.axis().scale(this.state.y2_scale).orient("right"),this.svg.append("g").attr("class","lz-y lz-y2 lz-axis").attr("transform","translate("+(this.view.width-this.view.margin.right)+","+this.view.margin.top+")").call(this.state.y2_axis)),this},LocusZoom.Panel.prototype.addDataLayer=function(t){if("function"!=typeof t)return!1;var i=new t;return i.parent=this,this._data_layers[i.id]=i,this.data_layer_ids_by_z_index.push(i.id),this._data_layers[i.id]},LocusZoom.Panel.prototype.reMap=function(){this.data_promises=[];for(var t in this._data_layers)this.data_promises.push(this._data_layers[t].reMap());return Q.all(this.data_promises).then(function(){this.render()}.bind(this)),this},LocusZoom.Panel.prototype.render=function(){if("function"==typeof this.xExtent&&(this.state.x_extent=this.xExtent(),this.axes.x.ticks=LocusZoom.prettyTicks(this.state.x_extent,this.view.cliparea.width/120,!0),this.state.x_scale=d3.scale.linear().domain([this.state.x_extent[0],this.state.x_extent[1]]).range([0,this.view.cliparea.width])),"function"==typeof this.y1Extent&&(this.state.y1_extent=this.y1Extent(),this.axes.y1.ticks=LocusZoom.prettyTicks(this.state.y1_extent),this.state.y1_scale=d3.scale.linear().domain([this.axes.y1.ticks[0],this.axes.y1.ticks[this.axes.y1.ticks.length-1]]).range([this.view.cliparea.height,0])),"function"==typeof this.y2Extent&&(this.state.y2_extent=this.y2Extent(),this.axes.y2.ticks=LocusZoom.prettyTicks(this.state.y2_extent),this.state.y2_scale=d3.scale.linear().domain([this.axes.y2.ticks[0],this.axes.y1.ticks[this.axes.y2.ticks.length-1]]).range([this.view.cliparea.height,0])),this.axes.x.render&&(this.state.x_axis=d3.svg.axis().scale(this.state.x_scale).orient("bottom").tickValues(this.axes.x.ticks).tickFormat(function(t){return LocusZoom.formatMegabase(t)}),this.svg.selectAll("g .lz-x.lz-axis").call(this.state.x_axis),null!=this.axes.x.label)){var t=this.axes.x.label;"function"==typeof this.axes.x.label&&(t=this.axes.x.label()),null==this.svg.select("text.lz-x.lz-axis.lz-label")[0][0]&&this.svg.select("g .lz-x.lz-axis").append("text").attr("class","lz-x lz-axis lz-label").attr("text-anchor","middle").attr("x",this.view.cliparea.width/2).attr("y",33),this.svg.select("text.lz-x.lz-axis.lz-label").text(t)}if(this.axes.y1.render&&(this.state.y1_axis=d3.svg.axis().scale(this.state.y1_scale).orient("left").tickValues(this.axes.y1.ticks),this.svg.selectAll("g .lz-y.lz-y1.lz-axis").call(this.state.y1_axis),null!=this.axes.y1.label)){var i=this.axes.y1.label;"function"==typeof this.axes.y1.label&&(i=this.axes.y1.label()),null==this.svg.select("text.lz-y1.lz-axis.lz-label")[0][0]&&this.svg.select("g .lz-y1.lz-axis").append("text").attr("class","lz-y1 lz-axis lz-label").attr("text-anchor","middle").attr("transform","rotate(-90 -28,"+this.view.cliparea.height/2+")").attr("x",-28).attr("y",this.view.cliparea.height/2),this.svg.select("text.lz-y1.lz-axis.lz-label").text(i)}this.axes.y2.render&&(this.state.y2_axis=d3.svg.axis().scale(this.state.y2_scale).orient("left").tickValues(this.axes.y2.ticks),this.svg.selectAll("g .lz-y.lz-y2.lz-axis").call(this.state.y2_axis));for(var e in this.data_layer_ids_by_z_index)this.data_layer_ids_by_z_index.hasOwnProperty(e)&&this._data_layers[this.data_layer_ids_by_z_index[e]].prerender().render();return this},LocusZoom.PositionsPanel=function(){return LocusZoom.Panel.apply(this,arguments),this.id="positions",this.axes.x.render=!0,this.axes.x.label=function(){return"Chromosome "+this.parent.state.chr+" (Mb)"}.bind(this),this.axes.y1.render=!0,this.axes.y1.label="-log10 p-value",this.xExtent=function(){return d3.extent(this._data_layers.positions.data,function(t){return+t.position})},this.y1Extent=function(){return d3.extent(this._data_layers.positions.data,function(t){return 1.05*+t.log10pval})},this},LocusZoom.PositionsPanel.prototype=new LocusZoom.Panel,LocusZoom.GenesPanel=function(){return LocusZoom.Panel.apply(this,arguments),this.id="genes",this.xExtent=function(){return d3.extent([this.parent.state.start,this.parent.state.end])},this},LocusZoom.GenesPanel.prototype=new LocusZoom.Panel;
"use strict";LocusZoom.DataLayer=function(){return this.id=null,this.parent=null,this.svg=null,this.fields=[],this.data=[],this.metadata={},this.postget=function(){return this},this.prerender=function(){return this},this.state={z_index:null},this.getBaseId=function(){return this.parent.parent.id+"."+this.parent.id+"."+this.id},this},LocusZoom.DataLayer.prototype.attachToYAxis=function(t){return"undefined"==typeof t&&(t=1),1!==t&&2!==t?!1:(this.parent.axes["y"+t+"_data_layer_id"]=this.id,this)},LocusZoom.DataLayer.prototype.initialize=function(){var t=this.parent.svg.append("g").attr("id",this.getBaseId()+".data_layer_container").attr("transform","translate("+this.parent.view.cliparea.origin.x+","+this.parent.view.cliparea.origin.y+")");t.append("clipPath").attr("id",this.getBaseId()+".clip").append("rect").attr("width",this.parent.view.cliparea.width).attr("height",this.parent.view.cliparea.height),this.svg=t.append("g").attr("id",this.getBaseId()+".data_layer").attr("clip-path","url(#"+this.getBaseId()+".clip)")},LocusZoom.DataLayer.prototype.reMap=function(){var t=this.parent.parent.lzd.getData(this.parent.parent.state,this.fields);return t.then(function(t){this.data=t.body,this.postget()}.bind(this)),t},LocusZoom.PositionsDataLayer=function(){return LocusZoom.DataLayer.apply(this,arguments),this.id="positions",this.fields=["id","position","pvalue","refAllele","ld:state"],this.postget=function(){return this.data.map(function(t,a){this.data[a].ld=+t["ld:state"],this.data[a].log10pval=-Math.log(t.pvalue)/Math.LN10}.bind(this)),this},this.render=function(){var t=this,a=function(){var a=d3.select(this);t.svg.selectAll("circle.lz-position").classed({"lz-selected":!1}),t.parent.parent.state.ldrefvar!=a.attr("id")?(a.classed({"lz-selected":!0}),t.parent.parent.state.ldrefvar=a.attr("id")):t.parent.parent.state.ldrefvar=null};this.svg.selectAll("*").remove(),this.svg.selectAll("circle.lz-position").data(this.data).enter().append("circle").attr("class","lz-position").attr("id",function(t){return t.id}).attr("cx",function(t){return this.parent.state.x_scale(t.position)}.bind(this)).attr("cy",function(t){return this.parent.state.y1_scale(t.log10pval)}.bind(this)).attr("fill",function(t){return this.fillColor(t.ld)}.bind(this)).on("click",a).attr("r",4).style({cursor:"pointer"}).append("svg:title").text(function(t){return t.id})},this.fillColor=function(t){var a=function(t){var a=function(a){if(null==a||isNaN(a))return 0;for(var e=0;e<t.length&&!(a<t[e]);e++);return e};return a},e=a([0,.2,.4,.6,.8]),i=["#B8B8B8","#357ebd","#46b8da","#5cb85c","#eea236","#d43f3a"][e(t)];return i},this},LocusZoom.PositionsDataLayer.prototype=new LocusZoom.DataLayer,LocusZoom.RecombinationRateDataLayer=function(){return LocusZoom.DataLayer.apply(this,arguments),this.id="recombination_rate",this.fields=[],this.render=function(){this.svg.selectAll("*").remove()},this},LocusZoom.RecombinationRateDataLayer.prototype=new LocusZoom.DataLayer,LocusZoom.GenesDataLayer=function(){return LocusZoom.DataLayer.apply(this,arguments),this.id="genes",this.fields=["gene:gene"],this.metadata.tracks=1,this.metadata.gene_track_index={1:[]},this.metadata.min_display_range_width=80,this.prerender=function(){return this.metadata.tracks=1,this.metadata.gene_track_index={1:[]},this.data.map(function(t,a){if(this.data[a].display_range={start:this.parent.state.x_scale(Math.max(t.start,this.parent.parent.state.start)),end:this.parent.state.x_scale(Math.min(t.end,this.parent.parent.state.end))},this.data[a].display_range.width=this.data[a].display_range.end-this.data[a].display_range.start,this.data[a].display_range.text_anchor="middle",this.data[a].display_range.width<this.metadata.min_display_range_width){if(t.start<this.parent.parent.state.start)this.data[a].display_range.end=this.data[a].display_range.start+this.metadata.min_display_range_width,this.data[a].display_range.text_anchor="start";else if(t.end>this.parent.parent.state.end)this.data[a].display_range.start=this.data[a].display_range.end-this.metadata.min_display_range_width,this.data[a].display_range.text_anchor="end";else{var e=(this.metadata.min_display_range_width-this.data[a].display_range.width)/2;this.data[a].display_range.start-e<this.parent.state.x_scale(this.parent.parent.state.start)?(this.data[a].display_range.start=this.parent.state.x_scale(this.parent.parent.state.start),this.data[a].display_range.end=this.data[a].display_range.start+this.metadata.min_display_range_width,this.data[a].display_range.text_anchor="start"):this.data[a].display_range.end+e>this.parent.state.x_scale(this.parent.parent.state.end)?(this.data[a].display_range.end=this.parent.state.x_scale(this.parent.parent.state.end),this.data[a].display_range.start=this.data[a].display_range.end-this.metadata.min_display_range_width,this.data[a].display_range.text_anchor="end"):(this.data[a].display_range.start-=e,this.data[a].display_range.end+=e)}this.data[a].display_range.width=this.data[a].display_range.end-this.data[a].display_range.start}this.data[a].display_domain={start:this.parent.state.x_scale.invert(this.data[a].display_range.start),end:this.parent.state.x_scale.invert(this.data[a].display_range.end)},this.data[a].display_domain.width=this.data[a].display_domain.end-this.data[a].display_domain.start,this.data[a].track=null;for(var i=1;null==this.data[a].track;){var s=!1;this.metadata.gene_track_index[i].map(function(t){if(!s){var a=Math.min(t.display_range.start,this.display_range.start),e=Math.max(t.display_range.end,this.display_range.end);e-a<t.display_range.width+this.display_range.width&&(s=!0)}}.bind(this.data[a])),s?(i++,i>this.metadata.tracks&&(this.metadata.tracks=i,this.metadata.gene_track_index[i]=[])):(this.data[a].track=i,this.metadata.gene_track_index[i].push(this.data[a]))}this.data[a].parent=this,this.data[a].transcripts.map(function(t,e){this.data[a].transcripts[e].parent=this.data[a],this.data[a].transcripts[e].exons.map(function(t,i){this.data[a].transcripts[e].exons[i].parent=this.data[a].transcripts[e]}.bind(this))}.bind(this))}.bind(this)),this},this.render=function(){this.svg.selectAll("*").remove(),this.svg.selectAll("g.lz-gene").data(this.data).enter().append("g").attr("class","lz-gene").attr("id",function(t){return t.gene_name}).each(function(t){d3.select(this).selectAll("rect.lz-gene").filter(".lz-boundary").data([t]).enter().append("rect").attr("class","lz-gene lz-boundary").attr("id",function(t){return t.gene_name}).attr("x",function(t){return this.parent.state.x_scale(t.start)}.bind(t.parent)).attr("y",function(t){return 40*t.track-20}).attr("width",function(t){return this.parent.state.x_scale(t.end)-this.parent.state.x_scale(t.start)}.bind(t.parent)).attr("height",1).attr("fill","#000099").style({cursor:"pointer"}).append("svg:title").text(function(t){return t.gene_name}),d3.select(this).selectAll("text.lz-gene").data([t]).enter().append("text").attr("class","lz-gene lz-label").attr("x",function(t){return"middle"==t.display_range.text_anchor?t.display_range.start+t.display_range.width/2:"start"==t.display_range.text_anchor?t.display_range.start:"end"==t.display_range.text_anchor?t.display_range.end:void 0}).attr("y",function(t){return 40*t.track-30}).attr("text-anchor",function(t){return t.display_range.text_anchor}).text(function(t){return"+"==t.strand?t.gene_name+"→":"←"+t.gene_name}),d3.select(this).selectAll("g.lz-gene").filter(".lz-exons").data([t]).enter().append("g").attr("class","lz-gene lz-exons").each(function(t){d3.select(this).selectAll("rect.lz-gene").filter(".lz-exon").data(t.transcripts[0].exons).enter().append("rect").attr("class","lz-gene lz-exon").attr("id",function(t){return t.exon_id}).attr("x",function(t){return this.parent.state.x_scale(t.start)}.bind(t.parent)).attr("y",function(){return 40*this.track-26}.bind(t)).attr("width",function(t){return this.parent.state.x_scale(t.end)-this.parent.state.x_scale(t.start)}.bind(t.parent)).attr("height",12).attr("fill","#000099").style({cursor:"pointer"})})})},this},LocusZoom.GenesDataLayer.prototype=new LocusZoom.DataLayer;

        if (typeof define === "function" && define.amd){
            this.LocusZoom = LocusZoom, define(LocusZoom);
        } else if (typeof module === "object" && module.exports) {
            module.exports = LocusZoom;
        } else {
            this.LocusZoom = LocusZoom;
        }

    } catch (plugin_loading_error){
        console.log("LocusZoom Plugin error: " + plugin_loading_error);
    }

}();